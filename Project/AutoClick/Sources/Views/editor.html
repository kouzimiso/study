<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Editor</title>
    <style>
        .indent {
            margin-left: 20px;
        }
    </style>
</head>
<body>
    <h1>JSON Editor</h1>
    <input type="file" id="fileInput" style="display: none">
    <button onclick="loadFile()">Read</button>
    <button onclick="downloadFile()">Download</button>
    <div id="jsonEditor"></div>

    <script>
        let jsonData = {};

        function loadFile() {
            const fileInput = document.getElementById('fileInput');
            fileInput.addEventListener('change', function (event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        try {
                            jsonData = JSON.parse(e.target.result);
                            renderEditor(jsonData, 'jsonEditor', 0);
                        } catch (error) {
                            alert('Invalid JSON file.');
                        }
                    };
                    reader.readAsText(file);
                }
            });
            fileInput.click();
        }

        function downloadFile() {
            const data = JSON.stringify(jsonData, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'edited.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function renderEditor(data, elementId, indentLevel = 0) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            renderData(data, container, [], indentLevel);
        }

        function renderData(data, container, path, parentIndentLevel) {
            if (typeof data === 'object') {
                const keys = Object.keys(data);

                for (const key of keys) {
                    const value = data[key];
                    const newPath = [...path, key];

                    const div = document.createElement('div');
                    div.className = 'indent';
                    div.style.marginLeft = `${parentIndentLevel * 20}px`;

                    const label = document.createElement('label');
                    label.textContent = key;
                    div.appendChild(label);

                    if (typeof value === 'object') {
                        const displayButton = document.createElement('button');
                        displayButton.textContent = 'Display';
                        displayButton.onclick = () => toggleDisplay(newPath);
                        div.appendChild(displayButton);
                        const childIndentLevel = parentIndentLevel + 1;

                        if (value instanceof Array) {
                            const addValueInput = document.createElement('input');
                            addValueInput.placeholder = 'New Value';
                            const addButton = document.createElement('button');
                            addButton.textContent = 'Add Value';
                            addButton.onclick = () => addArrayValue(newPath, addValueInput.value);
                            div.appendChild(addValueInput);
                            div.appendChild(addButton);
                            const deleteButton = document.createElement('button');
                            deleteButton.textContent = 'Delete';
                            deleteButton.onclick = () => deleteValue(newPath);
                            div.appendChild(deleteButton);

                            container.appendChild(div);

                        } else {
                            const addKeyInput = document.createElement('input');
                            addKeyInput.placeholder = 'New Key';
                            const addValueInput = document.createElement('input');
                            addValueInput.placeholder = 'New Value';
                            const addButton = document.createElement('button');
                            addButton.textContent = 'Add Key-Value';
                            addButton.onclick = () => addObjectKeyValue(newPath, addKeyInput.value, addValueInput.value);
                            div.appendChild(addKeyInput);
                            div.appendChild(addValueInput);
                            div.appendChild(addButton);
                            const deleteButton = document.createElement('button');
                            deleteButton.textContent = 'Delete';
                            deleteButton.onclick = () => deleteValue(newPath);
                            div.appendChild(deleteButton);

                            container.appendChild(div);

                        }

                        container.appendChild(div);

                        if (value._displayed) {
                            renderData(value, container, newPath, childIndentLevel);
                        }
                    } else {
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.value = value;
                        input.oninput = () => updateValue(newPath, input.value);
                        div.appendChild(input);
                        

                        const deleteButton = document.createElement('button');
                        deleteButton.textContent = 'Delete';
                        deleteButton.onclick = () => deleteValue(newPath);
                        div.appendChild(deleteButton);

                        container.appendChild(div);
                    }
                }
            }
        }


        function toggleDisplay(path) {
            const current = getNestedValue(jsonData, path);
            current._displayed = !current._displayed;
            renderEditor(jsonData, 'jsonEditor', 0)//path.length);
        }

        function updateValue(path, newValue) {
            const current = getNestedValue(jsonData, path);
            current[path[path.length - 1]] = newValue;
        }

        function deleteValue(path) {
            const parent = getNestedValue(jsonData, path.slice(0, -1));
            delete parent[path[path.length - 1]];
            renderEditor(jsonData, 'jsonEditor', 0)//path.length - 1);
        }

        function addArrayValue(path, newValue) {
            const current = getNestedValue(jsonData, path);
            try {
                const parsedValue = JSON.parse(newValue);
                current.push(parsedValue);
            } catch (error) {
                current.push(newValue);
            }
            renderEditor(jsonData, 'jsonEditor', 0)//path.length);
        }

        function addObjectKeyValue(path, newKey, newValue) {
            const current = getNestedValue(jsonData, path);
            try {
                const parsedValue = JSON.parse(newValue);
                current[newKey] = parsedValue;
            } catch (error) {
                current[newKey] = newValue;
            }
            renderEditor(jsonData, 'jsonEditor', 0)//path.length);
        }

        function getNestedValue(obj, path) {
            let current = obj;
            for (const key of path) {
                current = current[key];
            }
            return current;
        }
    </script>
</body>
</html>
